# ============================================
# CORS Headers Configuration for Nginx
# ============================================
# 
# Copy this block and paste it INSIDE the HTTPS server block
# for api.quickkasir.com (after "location /" block, before "location ~ \.php$")
#
# Location: Inside server block with:
#   server_name admin.quickkasir.com api.quickkasir.com;
#   listen 443 ssl http2;
#
# ============================================

    # CORS headers for Filament static assets (fonts, JS, CSS)
    # This allows admin.quickkasir.com to load assets from api.quickkasir.com
    location ~* \.(woff2?|woff|ttf|eot|js|css)$ {
        # Allow requests from Filament admin panel
        add_header 'Access-Control-Allow-Origin' 'https://admin.quickkasir.com' always;
        add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept' always;
        add_header 'Access-Control-Max-Age' 86400 always;
        
        # Cache static assets
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;

        # Handle OPTIONS preflight requests
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' 'https://admin.quickkasir.com' always;
            add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept' always;
            add_header 'Access-Control-Max-Age' 86400 always;
            add_header 'Content-Length' 0;
            add_header 'Content-Type' 'text/plain';
            return 204;
        }
    }

# ============================================
# Instructions:
# ============================================
# 1. Edit Nginx config:
#    sudo nano /etc/nginx/sites-available/kasir-pos
#
# 2. Find the HTTPS server block (listen 443) for api.quickkasir.com
#
# 3. Add the location block above AFTER the "location /" block
#    and BEFORE the "location ~ \.php$" block
#
# 4. Test configuration:
#    sudo nginx -t
#
# 5. If OK, reload Nginx:
#    sudo systemctl reload nginx
#
# 6. Verify with:
#    bash scripts/verify-nginx-cors-vps.sh
#
# ============================================
